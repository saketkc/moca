
sudo: false
language: python

matrix:
  include:
    - python: 2.7

addons:
  apt:
    packages:
      - texlive-latex-base
      - texlive-latex-extra
      - texlive-fonts-recommended
      - texlive-latex-recommended
      - texlive-xetex

after_script:
 - codecov
 - coveralls
 - source deactivate mocadev
 - conda remove --name mocadev --all

before_install:
  - export MINICONDA=$HOME/miniconda
  - export PATH="$MINICONDA/bin:$PATH"
  - hash -r
  - command -v conda >/dev/null || { wget http://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh
    -O miniconda.sh; bash miniconda.sh -b -f -p $MINICONDA; }
  - conda config --set always_yes yes
  - conda update conda
  - conda info -a
  - conda install python=$TRAVIS_PYTHON_VERSION
  - conda remove --name mocadev --all || echo 'removed'
  - conda config --add channels bioconda
  - conda config --add channels r
  - conda env create -q -f environment.yml python=$TRAVIS_PYTHON_VERSION
  - source activate mocadev
  - pip install pytest-mpl codecov
  - bash travis/install_meme.sh
  - export PATH="$PATH:$HOME/meme_bin/bin"

install:
  - python setup.py install --single-version-externally-managed --record=/tmp/record.txt

script:
  - moca --help
  - py.test --verbose --mpl --cov=moca --cov-config .coveragerc --cov-report term-missing

cache:
  directories:
    - $HOME/miniconda
    - $HOME/meme_bin

deploy:
  true:
    condition: $TRAVIS_PYTHON_VERSION == 2.7
    repo: saketkc/moca
    tags: true
  distributions: sdist bdist_wheel
  password:
    secure: H6tfTQmXvBqzlArZ0YQQNEyKpkCZ1Z6xjsv8O1ng7zBwvf4V2JxtG2Ccd3k1gCLnktnyuyv2DJ7I30WEW/xZdprWjB9N63nW1Nug2KWIpSUG0URwqZwgZ0fYez71Z5UI0nfqKEdt3FmrXwcAe2JJCuIweHqYTZVTRfJ88blEakNvm7q0iXcpXyBnuHrTVoBHkT/kEhvDph+nof8JrC9tQ/DGG6v2Ftff3lCFjR0i1LA+p5YsZzvM0kQtYVbnQ6IMnvbKt0kNcFc4Xb0wz0KSZlbaaepS9zPZI2QOcz0ttnQW+pHLNvIDcspB9gD2XveYJspL/yNELr7GQGz2RhqF2+TJX9NPaq9acuLAhr23lhnpSkjgp1m/JtlAasQrYcwEKyJBLLFOOx8IE/R25912m8klzfupu+UStxJPI5tJexoSYBeiPh50tzYvaEaeCKPzmDQqUBYpJvKop/8QsZlmctt+pSrf0ifDsxI5XZJkJhmpq3cjxP6kJfZEKZcDNxcDtz92UCjf0jVFSFIJEQJFhOof2k2J6QhkhhklwCs5BR0Hn21whjTD1W2SES0JYqrJGi+bq/004vCbR4ndU/NIoS97RkbypEKMcZ4u9GIUyljyeIXIfttvIfH5gDn6Hfk2OHavSgQkzekP5G+Lu4e8VW5MwCYIJ+l9/xGnR4DvbD0=
  provider: pypi
  user: saketkc
